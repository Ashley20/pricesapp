function googleLoginCallback(n){n&&SocialLoginService.getGoogleProfile(n.access_token)}var AuthenticationValidationService=function(){var n=function(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)},t=function(n){return!!n&&n.length>5&&n.length<17};return{validateEmail:n,validatePassword:t}}(),LoginService=function(){var r=tycommon.configuration.BasePath,u={LOGIN_SUBMIT:r+"/Authentication/Login"},n={INVALID_EMAIL:"Lütfen email adresinizi giriniz.",INVALID_PASSWORD:"Şifreniz 3-16 karakter arasında olmalıdır.",PASSWORD_REQUIRED:"Lütfen şifre giriniz.",GENERIC_ERROR:"Bir şeyler ters gitti, lütfen tekrar deneyiniz."},t=function(n){$("#errorBox").fadeIn("fast");$("#errorBox").html(n)},f=function(){$("#errorBox").fadeOut("fast");$("#errorBox").html("")},e=function(t){var r=$(t),i;return AuthenticationValidationService.validateEmail(r.find("input.email").val())?(i=r.find("input.password").val(),!i||i.length===0)?{isSuccess:!1,messageHtml:n.PASSWORD_REQUIRED}:!!i&&i.length<3?{isSuccess:!1,messageHtml:n.INVALID_PASSWORD}:{isSuccess:!0,messageHtml:""}:{isSuccess:!1,messageHtml:n.INVALID_EMAIL}},i=function(n,i,r,f){var s=e(n),o;f=typeof f!="undefined"?f:"";s.isSuccess?(o=$(n).serialize(),o.indexOf("email")===-1&&f.length>0&&(o+="&email="+f),authenticationLoaderService.show(),$.ajax({type:"POST",xhrFields:{withCredentials:!0},url:u.LOGIN_SUBMIT,data:o,success:function(n){authenticationLoaderService.hide();i(n)},error:function(n,t,i){authenticationLoaderService.hide();r(n,t,i)}})):(authenticationLoaderService.hide(),t(s.messageHtml))},o=function(r){var e=document.getElementById("loginForm"),u,f;return r=typeof r!="undefined"?r:"",u=function(i){var u,r,f;i?i.OperationResult?(u=UrlService.updateQueryStringParameter(document.location.href,"e","login"),r=document.getElementById("redirectAfterLogin"),r&&r.value==="true"?window.location.href=u:(tycommon.accountNavigation.refreshNavigationMenu(),AuthenticationPopupService.closePopup(),window.dispatchEvent(new CustomEvent("user_logged_in")))):(f=i.ErrorMessages&&i.ErrorMessages.length>0?i.ErrorMessages[0]:n.GENERIC_ERROR,t(f)):t(n.GENERIC_ERROR)},f=function(){t(n.GENERIC_ERROR)},i(e,u,f,r),!1},s=function(n,t){SocialLoginService.matchThirdPartyUser(n.ThirdPartySiteId,n.ThirdPartyUserId,n.Email,t,function(){var n=UrlService.updateQueryStringParameter(document.location.href,"e","login");window.location.href=n})},h=function(r){var e=document.getElementById("loginForm"),u,f;return r=typeof r!="undefined"?r:"",u=function(i){var r,u;i?i.OperationResult&&i.TokenResponse?(r={Email:document.getElementById("Email").value,ThirdPartySiteId:document.getElementById("ThirdPartySiteId").value,ThirdPartyUserId:document.getElementById("ThirdPartyUserId").value},s(r,i.TokenResponse.AccessToken)):(u=i.ErrorMessages&&i.ErrorMessages.length>0?i.ErrorMessages[0]:n.GENERIC_ERROR,t(u)):t(n.GENERIC_ERROR)},f=function(){t(n.GENERIC_ERROR)},i(e,u,f,r),!1};return{submit:o,hideErrors:f,thirdPartyLoginBeforeThirdPartyMatch:h}}(),SocialLoginService;$("input.email, input.password").focus(function(){LoginService.hideErrors()});$(document).ready(function(){$(document).on("keypress",function(n){$(".login").is(":visible")&&n.which===13&&LoginService.submit()})});SocialLoginService=function(){var f="/authentication/thirdPartyLogin",e="MatchThirdPartyUser",o=tycommon.configuration.MobileServiceBasePath,s=tycommon.configuration.FacebookClientId,i=tycommon.configuration.GoogleClientId,h="https://graph.facebook.com/me?fields=email,gender&access_token=",c="https://www.googleapis.com/oauth2/v2/userinfo?access_token=",n={facebook:1,google:2},r={UserExists:8,RegisterReqiured:9},l=function(){window.fbAsyncInit=function(){FB.init({appId:s,autoLogAppEvents:!0,xfbml:!0,status:!1,version:"v2.8"})}},k=function(){gapi.client.setApiKey(i);gapi.client.load("plus","v1",function(){})},a=function(){l()},v=function(t,i){return t===n.facebook?h+i:c+i},t=function(n,t,i){var r=v(n,t);authenticationLoaderService.show();$.ajax({type:"GET",url:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){authenticationLoaderService.hide();i(!0,n)},error:function(n){authenticationLoaderService.hide();i(!1,n)}})},u=function(n,i,u){if(i&&i.length>0){var e={ThirdPartyAccessToken:i,ThirdPartyServiceTypeId:n},o=tycommon.configuration.BasePath+f;authenticationLoaderService.show();$.ajax({type:"POST",url:o,data:e,xhrFields:{withCredentials:!0},success:function(f){var e,o;authenticationLoaderService.hide();f&&f.OperationResult?(e=document.getElementById("redirectAfterLogin"),e&&e.value==="true"?(o=UrlService.updateQueryStringParameter(document.location.href,"e","login"),window.location.href=o):(tycommon.accountNavigation.refreshNavigationMenu(),AuthenticationPopupService.closePopup(),window.dispatchEvent(new CustomEvent("user_logged_in")))):(f&&f.ErrorType===r.UserExists&&t(n,i,function(t,i){t&&AuthenticationPopupService.openMatchThirdParty(i.email,u,n)}),f&&f.ErrorType===r.RegisterReqiured&&t(n,i,function(t,i){t&&AuthenticationPopupService.openThirdPartyRegister(i.email,i.gender,u,n)}))}})}},y=function(n,t,i,r,u){var f={Application:"7",Email:i,ThirdPartySiteId:n,ThirdPartyUserId:t,Token:{Ticket:r,UserId:0}};authenticationLoaderService.show();$.ajax({type:"POST",url:o+e,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(f),success:function(n){authenticationLoaderService.hide();u(n)},error:function(n){authenticationLoaderService.hide();u(n)}})},p=function(){FB.login(function(t){t&&t.authResponse&&t.authResponse.accessToken&&t.authResponse.accessToken.length>0&&u(n.facebook,t.authResponse.accessToken,t.authResponse.userID)},{scope:"email,public_profile"})},w=function(){var n={clientid:i,cookiepolicy:"single_host_origin",callback:"googleLoginCallback",approvalprompt:"force",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/plus.profile.emails.read"};gapi.auth.signIn(n)},b=function(i){t(n.google,i,function(t,r){t&&r&&u(n.google,i,r.id)})};return{init:a,loginWithFacebook:p,loginWithGoogle:w,matchThirdPartyUser:y,getGoogleProfile:b}}();window.onload=function(){SocialLoginService.init()}