var DataLayer=function(){var n=function(n){window.dataLayer=window.dataLayer||[];dataLayer.push(n)};return{push:n}}(),cookieService=function(){var n=function(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r===n)return unescape(decodeURIComponent(u.replace(/\+/g," ")));return undefined},t=function(n,t){var e={cookieName:n,cookieProperty:t},u=this.getCookie(e.cookieName),f,r,i,o,s;if(u!==undefined&&u!==null)for(f=u.split("&").length,r=u.split("&"),i=0;i<f;i++){if(f===1)return r[i];if(r[i].split("=")[0]===e.cookieProperty)return o=r[i].split("=")[0],s=r[i].substring((o+"=").length,r[i].length),s}return undefined};return{getCookieValue:t,getCookie:n}}();$(document).ready(function(){var n={rootContainer:".header-search-box-container",resultContainer:"#autoComplateResultContainer",submitButton:".autocomplete-submit-button",postUrl:$("#suggestionsPostUrl").val(),redirectUrl:$("#siteAddress").val(),redBoutiqueTimerMinDayCount:2,showBoutiqueRemaningDayMinDayCount:8,storefrontId:$("#storefrontId").val(),searchSuggestionGenderTest:$("#searchSuggestionGenderTest").val(),imagePath:tycommon.configuration.BasePath};$("#AutoCompleteBox").autoComplete(n)}),function(n){function t(i,r){this.settings=null;this.options=n.extend({},t.Defaults,r);this.constants=t.Constants;this.keyCodes=t.KeyCodes;this.templates=t.Templates;this.eventTypes=t.EventTypes;this.$element=n(i);this.$submitButton=n(this.options.submitButton);this.$resultContainer=n(this.options.resultContainer);this.$rootContainer=n(this.options.rootContainer);this.q="";this.cursorPosition=null;this.isAllSelected=!1;this.genderTypeTest="A";this.setup()}t.Defaults={defaultKeyword:"Kategori veya marka ara",resultContainer:"#resultContainer",rootContainer:"#rootContainer",submitButton:"",postUrl:"",redirectUrl:"",redirectToAllProductsSegment:"tum--urunler",searchQueryParam:"q"};t.Constants={slideUpTimeout:300,slideDownTimeout:500,autoCompleteMinLength:1,autoCompleteMaxLength:50};t.EventTypes={brand:"brand",category:"category",boutique:"boutique",freeTerm:"freeTerm",staticKeyword:"static",suggestionNotUsed:"suggestionNotUsed"};t.KeyCodes={enter:13,downArrow:40,upArrow:38};t.Templates={searchItem:'<div class="search-item"><a class="brand-category-search-link" data-brandcategorytypeid="{{BrandCategoryTypeId}}" href="javascript:void(0);" data-href="{{Url}}">{{item}}<\/a><\/div>',brandCategoryListResult:'<div class="search-result-list"><div class="title">İlgili Sonuçlar<\/div><div id="brandCategorySuggestions">{{brandCategories}}<\/div><\/div>',suggestedProductBox:'<div class="search-result-product-box"><a href="" class="search-result-product-box-inner"><div class="product-box-image-container"><img class="product-box-image" src="{{imagePath}}"><\/div><div class="product-info-container"><p class="brand"><p><p class="name"><\/p><p class="price-container"><span class="market-price"><\/span><span class="sale-price"><\/span><\/p><\/div><div class="product-box-detail-container"><\/div><\/a><\/div>',brandCategoryTemplate:'<div class="search-item-key {{subCategoryClass}}" data-type="brandcategory">{{Name}}<\/div><div class="search-item-info">{{Type}}<\/div><div class="clear"><\/div>',boutiqueListResult:'<div class="boutique-result-list"><div class="title">İlgili Butikler<\/div>{{BoutiqueResult}}<\/div>',boutiqueSearchItem:'<div class="search-item" ty-index="1"><a class="boutique-url" href="{{BoutiqueUrl}}"><div class="search-item-key" data-type="boutique">{{BoutiqueName}}<\/div><div class="search-item-info">{{remainingDayAlert}}<\/div><div class="clear"><\/div><\/a><\/div>',pageListResult:'<div class="page-result-list"><div id="pageSuggestions">{{PageResult}}<\/div><\/div>',pageSearchItem:'<div class="search-item" ty-index="1"><a href="{{PageUrl}}"><div class="search-item-key" data-type="pageResult">{{PageName}}<\/div><div class="clear"><\/div><\/a><\/div>',keywordListResult:'<div class="search-result-list"><div id="keywordSuggestions">{{keywords}}<\/div><\/div>',keywordTemplate:'<div class="search-item-key {{subCategoryClass}}" data-type="keyword">{{Name}}<\/div><div class="search-item-info">{{Type}}<\/div><div class="clear"><\/div>',keywordSearchItem:'<div class="search-item"><a class="brand-category-search-link" href="javascript:void(0);" data-href="{{Url}}">{{item}}<\/a><\/div>'};t.prototype.setup=function(){this.initPlaceholder();this.setSearchSuggestionTest();this.registerEvents()};t.prototype.initPlaceholder=function(){if(window.isSearchResult){var t=this.getParam("qt"),n=decodeURIComponent(t);n!==""&&n!="null"&&this.$element.val(n)}};t.prototype.setSearchSuggestionTest=function(){var r=this,i=parseInt(this.getCookie("AbTesting")),t=this.options.searchSuggestionGenderTest,n;!!t&&t.length>0&&(n=t.split(","),!n||n.length!==2||n.forEach(function(n){var u=n.split("_"),t,f,e;!u||u.length!==2||(t=u[1].split("-"),!t||t.length!==2||(f=parseInt(t[0]),e=parseInt(t[1]),f<=i&&e>=i&&(r.genderTypeTest=u[0])))}))};t.prototype.getParam=function(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null};t.prototype.registerEvents=function(){var t=this;n("body").on("click",n.proxy(this.hideResult,this));this.$element.bind("keyup",n.proxy(this.keyUp,this));this.$element.bind("keypress",n.proxy(this.handleIe9Submit,this));this.$element.bind("focusout",n.proxy(this.onFocusOut,this));this.$element.bind("click",n.proxy(this.onTextBoxFocus,this));this.$submitButton.bind("click",n.proxy(this.onSearchButtonClicked,this));n(document).delegate(".brand-category-search-link","click",function(){var r=n(this).attr("data-href"),u=n(this).attr("data-brandcategorytypeid"),f=n(this).find(".search-item-key"),i;t.q=f.text();i=t.getBrandCategoryEvent(u);DataLayer.push({event:"suggestionUsed",filtertype:i});t.setSearchDataCookie(t.getSearchDataCookiePayload(t.q,!0,i));window.location.href=r});n(document).delegate(".boutique-url","click",function(){var i=n(this).attr("href");DataLayer.push({event:"suggestionUsed",filtertype:t.eventTypes.boutique});window.location.href=i});n(document).delegate(".search-item","mouseenter",function(){t.removeAllSelectedWithoutClickEvent();n(this).addClass("selectedWithoutClickEvent")})};t.prototype.onTextBoxFocus=function(){var n=this;n.isAllSelected||!n.$element.val()||n.$element.val()==""||(n.$element.select(),n.isAllSelected=!0)};t.prototype.handleIe9Submit=function(n){var t=this,i=n||window.event,r=i.which||i.keyCode;r===t.keyCodes.enter&&(t.q=t.$element.val(),t.redirectWithSearchQuery())};t.prototype.keyUp=function(n){var t=this,i,r;n||(n=window.event);n.preventDefault();n.stopPropagation();i=t.GetKeyCode(n);i===t.keyCodes.enter?(t.q=t.$element.val(),t.redirectWithSearchQuery()):i===t.keyCodes.upArrow?(t.selectSuggestion(),r=t.$element.val(),t.$element.focus().val("").val(r)):i===t.keyCodes.downArrow?t.selectSuggestion(!0):(t.q=t.$element.val(),t.removeUnsecure(),t.GetSuggestions())};t.prototype.onSearchButtonClicked=function(){var n=this;n.redirectWithSearchQuery()};t.prototype.GetSuggestions=function(){var t=this,r=cookieService.getCookieValue("COOKIE_"+tycommon.configuration.LoginCookieName,"Gender"),i;jQuery.support.cors=!0;i=t.options.postUrl+"?query="+t.q+"&storefrontId="+t.options.storefrontId;!r||(i+="&gender="+r);t.isValidSearchQuery()?n.ajax({url:i,contentType:"text/plain",type:"GET",dataType:"json",success:function(n){t.showResult(n)},error:function(){}}):t.hideResult(null,!0)};t.prototype.getBrandCategoryEvent=function(n){return n==="1"?this.eventTypes.category:n==="2"?this.eventTypes.brand:this.eventTypes.freeTerm};t.prototype.redirectWithSearchQuery=function(){var t=this,i=n(".search-item.selected"),r;if(i.length===1){var u=i.find(".search-item-key").attr("data-type"),e=i.find("a"),f=t.getBrandCategoryEvent(e.attr("data-brandcategorytypeid"));t.q=i.find(".search-item-key").text();u==="brandcategory"||u==="keyword"?(r=i.find("a").attr("data-href"),t.setSearchDataCookie(t.getSearchDataCookiePayload(t.q,!0,f))):r=i.find("a").attr("href");u==="boutique"&&(f=t.eventTypes.boutique);DataLayer.push({event:"suggestionUsed",filtertype:f});window.location.href=r}else t.isValidSearchQuery()&&(r=t.options.redirectUrl+"/"+t.options.redirectToAllProductsSegment+"?"+t.options.searchQueryParam+"="+t.q+"&st="+n("#AutoCompleteBox").val()+"&qt="+encodeURIComponent(t.q)+"&qs=search",t.setSearchDataCookie(t.getSearchDataCookiePayload("",!1,"")),DataLayer.push({event:t.eventTypes.suggestionNotUsed}),window.location.href=r)};t.prototype.selectSuggestion=function(t){var i=this,u=n(".search-item.selected"),s=u.index(),f,e,r,o;t?u.length===0?n(".search-item:first").addClass("selected"):(f=u.next(),f.length===0?(r=n(".search-item.selected").find(".search-item-key").attr("data-type"),r==="brandcategory"&&n(".boutique-result-list").length>0&&(i.removeAllSelected(),n(".boutique-result-list > .search-item:first").addClass("selected"))):f.hasClass("search-item")&&(i.removeAllSelected(),f.addClass("selected"))):(e=u.prev(),e.hasClass("title")?(r=n(".search-item.selected").find(".search-item-key").attr("data-type"),r==="boutique"&&n(".search-result-list").length>0&&(i.removeAllSelected(),n("#brandCategorySuggestions > .search-item:last").addClass("selected"))):e.hasClass("search-item")&&(i.removeAllSelected(),e.addClass("selected")));o=n(".search-item.selected .search-item-key").text();o&&this.$element.val(o);t||s!==0||(this.$element.val(this.q),i.removeAllSelected())};t.prototype.removeAllSelected=function(){n(".search-item.selected").removeClass("selected")};t.prototype.removeAllSelectedWithoutClickEvent=function(){n(".search-item.selectedWithoutClickEvent").removeClass("selectedWithoutClickEvent")};t.prototype.isValidSearchQuery=function(){var n=this;return n.q!==""&&n.q.length>n.constants.autoCompleteMinLength};t.prototype.showResult=function(n){var t=this;n!=null&&(n.BrandCategorySuggestions!=null||n.KeywordSuggestions!=null||n.BoutiqueSuggestions!=null||n.StaticSuggestions!=null)?n.BrandCategorySuggestions.length>0||n.KeywordSuggestions.length>0||n.BoutiqueSuggestions.length>0||n.StaticSuggestions.length>0?(t.clearResults(),t.appendResult(n),t.$resultContainer.slideDown("fast",function(){})):t.hideResult(null,!0):t.hideResult(null,!0)};t.prototype.clearResults=function(){n(".search-result-list").remove();n(".search-result-product-box").remove();n(".boutique-result-list").remove();n(".page-result-list").remove()};t.prototype.appendResult=function(t){var i=this,r,e,o,u,s,f,h;!t||((t.BrandCategorySuggestions!=null&&t.BrandCategorySuggestions.length>0||t.KeywordSuggestions!=null&&t.KeywordSuggestions.length>0)&&(r="",t.BrandCategorySuggestions.forEach(function(n){n.Type===6&&i.genderTypeTest==="A"||(r+=i.getBrandCategoryTemplate(n))}),t.KeywordSuggestions.forEach(function(n){r+=i.getBrandCategoryTemplate(n)}),e=i.templates.brandCategoryListResult.replace("{{brandCategories}}",r),n(".search-container").append(e)),!t.SuggestedProduct||(o=t.SuggestedProduct,n(".search-container").append(i.getSuggestedProductBoxTemplate(o))),t.BoutiqueSuggestions!=null&&t.BoutiqueSuggestions.length>0&&(u="",t.BoutiqueSuggestions.forEach(function(n){u+=i.getBoutiqueTemplate(n)}),s=i.templates.boutiqueListResult.replace("{{BoutiqueResult}}",u),n(".search-container").append(s)),t.StaticSuggestions!=null&&t.StaticSuggestions.length>0&&(f="",t.StaticSuggestions.forEach(function(n){f+=i.getPageTemplate(n)}),h=i.templates.pageListResult.replace("{{PageResult}}",f),n(".search-container").append(h)))};t.prototype.getSuggestedProductBoxTemplate=function(t){var r=this.options.imagePath+"/Resources/images/defaultThumb.jpg",u=this.templates.suggestedProductBox.replace("{{imagePath}}",r),i=n(u);return t.IsDiscounted&&i.addClass("discounted"),i.find(".product-box-image").prop("src",t.ImageUrl).error(function(){this.src=r}),i.find("a.search-result-product-box-inner").prop("href",t.ProductDetailUrl),i.find(".brand").html(t.BrandName),i.find(".name").html(t.ProductName.replace(new RegExp("(^|)("+this.q+")(|$)","ig"),"$1<b>$2<\/b>$3")),i.find(".sale-price").text(t.SalePrice+" TL"),t.IsDiscounted?i.find(".market-price").text(t.MarketPrice+" TL"):i.find(".market-price").remove(),i};t.prototype.hideResult=function(n,t){var i=this;(n&&n.target!=null&&!i.$rootContainer.is(n.target)&&i.$rootContainer.has(n.target).length===0||t)&&i.$resultContainer.hide()};t.prototype.GetKeyCode=function(n){return n.which?n.which:n.keyCode};t.prototype.removeUnsecure=function(){var n=this,t=n.q.match(/(%3C*|<)|(%3E*|>)|[Jj]avascript:*|document.|setTimeout.*|setInterval.*|alert.*/g,"");t!=null&&t.length>0&&(n.q="")};t.prototype.getBrandCategoryTemplate=function(t){var i=this,f=null,u;if(t){u=t.Text;t.Text=t.Text.toLocaleLowerCase("tr");t.Text=t.Text.replace(i.q.toLocaleLowerCase("tr"),"<b>"+i.q.toLocaleLowerCase("tr")+"<\/b>");var r="",o="",s="",e="",h=t.Type===6,c=h?"sub-brand-category":"";t.BrandCategoryTypeId?(r=i.templates.brandCategoryTemplate,o=t.Text,s=t.BrandCategoryTypeId===1?"Kategori":t.BrandCategoryTypeId===2?"Marka":"",e=t.BrandCategoryTypeId===1||t.BrandCategoryTypeId===2?i.options.redirectUrl+"/"+t.BeautifiedName+"?st="+n("#AutoCompleteBox").val()+"&qt="+encodeURIComponent(u):i.options.redirectUrl+"/"+i.options.redirectToAllProductsSegment+"?q="+u+"&st="+n("#AutoCompleteBox").val()+"&qt="+encodeURIComponent(u)+"&ffts=true"):(r=i.templates.keywordTemplate,o=t.Text,s="",e=i.options.redirectUrl+"/"+i.options.redirectToAllProductsSegment+"?q="+u+"&st="+n("#AutoCompleteBox").val()+"&qt="+encodeURIComponent(u)+"&ffts=true");e+="&qs=search";r=r.replace("{{subCategoryClass}}",c);r=r.replace("{{Name}}",o).replace("{{Type}}",s);f=i.templates.searchItem.replace("{{item}}",r).replace("{{Url}}",e);f=f.replace("{{item}}",r).replace("{{BrandCategoryTypeId}}",t.BrandCategoryTypeId)}return f};t.prototype.getBoutiqueTemplate=function(t){var i=this,r=null,u,f;return t&&(t.Text=t.Text.toLocaleLowerCase("tr"),t.Text=t.Text.replace(i.q.toLocaleLowerCase("tr"),"<b>"+i.q.toLocaleLowerCase("tr")+"<\/b>"),r=i.templates.boutiqueSearchItem.replace("{{BoutiqueName}}",t.Text).replace("{{BoutiqueUrl}}",t.BoutiqueDetailUrl+"?st="+n("#AutoCompleteBox").val()),u="",t.RemainingDurationInDay<=i.options.showBoutiqueRemaningDayMinDayCount&&(f=t.RemainingDurationInDay===0?"":" "+t.RemainingDurationInDay,u=t.RemainingDurationInDay<=i.options.redBoutiqueTimerMinDayCount?'<span class="almost-ending-boutique"><i class="icon icon-time-red"><\/i>Son'+f+" Gün<span>":'<span><i class="icon icon-time"><\/i>Son'+f+" Gün<\/span>"),r=r.replace("{{remainingDayAlert}}",u)),r};t.prototype.getPageTemplate=function(n){var i=this,t=null;return n&&(t=i.templates.pageSearchItem.replace("{{PageName}}",n.Text).replace("{{PageUrl}}",n.BeautifiedUrl)),t};t.prototype.cacheQuery=function(){this.setCookie("searchQuery",this.q,1)};t.prototype.setCookie=function(n,t,i){var r=new Date,u;r.setDate(r.getDate()+i);u=escape(t)+(i==null?"":"; expires="+r.toUTCString());document.cookie=n+"="+u};t.prototype.createCookieInSeconds=function(n,t,i){var r=new Date,u;r.setTime(r.getTime()+i*1e3);u="; expires="+r.toGMTString();document.cookie=n+"="+t+u+"; path=/"};t.prototype.getCookie=function(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r==n)return unescape(u)};t.prototype.getSearchDataCookiePayload=function(t,i,r){var f=n(".autocomplate-result").css("display")!=="none",h=n(".search-result-list .search-item a .search-item-key "),e=[],o=0,u,s;return h.each(function(i){var r=n(this).text();r===t&&(o=i);e.push(r)}),u=n("#AutoCompleteBox").val(),s={searchTerm:t||u,textboxTerm:u,suggestionViewed:f.toString(),suggestionClicked:i.toString(),suggestionPhrase:f?e.join("|"):"",suggestionType:r,suggestionPhraseOrder:o.toString(),historyClicked:"false"},s};t.prototype.setSearchDataCookie=function(n){if(n){var t=JSON.stringify(n);this.createCookieInSeconds("sdata",t,30)}};n.fn.autoComplete=function(n){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){new t(this,typeof n=="object"&&n)})};n.fn.autoComplete.Constructor=t}(window.jQuery)